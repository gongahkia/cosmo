# Cosmo - Comprehensive Improvement Roadmap
# Generated: 2025-11-29
# Updated: 2025-12-13
# Philosophy: Maintain research-driven, empirically-backed terrain generation while improving accessibility for practitioners and industry use

================================================================================
COMPLETED FIXES (2025-12-13)
================================================================================

✅ [P0] Fixed module reference bug in cells.lua:11
  - Changed cellular_utils.count_neighbors to cells.count_neighbors
  - Status: FIXED

✅ [P0] Fixed module reference bug in color.lua:15
  - Changed color_utils.lerp_color to color.lerp_color
  - Status: FIXED

✅ [P0] Created shared math utilities module
  - Created src/helper/math.lua with common math utilities
  - Includes: clamp, lerp, smoothstep, remap, normalize, round, sign, distance, manhattan_distance
  - Updated all generators to use math_utils.clamp instead of local implementations
  - Status: IMPLEMENTED

✅ [P0] Standardized generator API across all 20 generators
  - All generators now follow module.generate(width, height, params) pattern
  - Removed file I/O from all generators (moved to main.lua)
  - All generators return terrain table only
  - Added params support to all generators with sensible defaults
  - Status: FULLY STANDARDIZED

✅ [P0] Fixed duplicate 'U' key in main.lua terrainColors
  - Merged duplicate 'U' entries (underground and cave now use same color)
  - Status: FIXED

✅ [P0] Added missing love.math.random() to test helpers
  - Added love.math.random() and love.math.randomseed() mocks
  - Tests can now properly mock all Love2d math functions
  - Status: FIXED

✅ [P1] Created .luacheckrc configuration file
  - Configured for Lua 5.1/LuaJIT
  - Set up Love2d globals
  - Status: CREATED

✅ [P1] Created .stylua.toml configuration
  - Set column width, indent type, quote style
  - Status: CREATED

✅ [P1] Created config.yaml
  - Comprehensive configuration for all 20 generators
  - Includes default parameters, research citations, window settings
  - Status: CREATED

================================================================================
CRITICAL BUGS (Remaining - Fix immediately)
================================================================================

[P0] Remove file I/O calls from main.lua generator invocations
  - main.lua still expects generators to handle file I/O
  - Need to update main.lua:123-161 to handle file writing
  - Update pattern: map = generators.X.generate(120, 80) → file_utils.save_map(map, "map.txt")

[P0] Update test suite for new generator API
  - test/test_generators.lua expects old return values
  - Need to update tests to work with new terrain-only returns
  - Add tests for params support

================================================================================
CONFIGURATION & MISSING FILES (Remaining)
================================================================================

[P1] Implement config.yaml loading in main.lua
  - Parse config.yaml on startup
  - Use config values for window settings and default parameters
  - Requires YAML parser library (lyaml or similar)

[P1] Remove "diagrams" from requirements.txt
  - Python package, irrelevant for Lua project
  - Likely copy-paste error
  - Status: PENDING

================================================================================
CODE QUALITY & CONSISTENCY (Ongoing improvements)
================================================================================

[P2] Extract magic numbers to named constants
  - Many hardcoded values in generators
  - Create generator-specific config tables
  - Improves readability and tweakability

[P2] Add parameter validation to all generators
  - Add bounds checking: width >= 3, height >= 3
  - Validate param ranges (e.g., 0 <= erosion_level <= 1)
  - Return meaningful error messages

[P2] Improve noise function abstraction
  - Create abstraction layer in noise.lua
  - Support multiple noise types: Perlin, Simplex, Worley
  - Easier testing and algorithm swapping

[P2] Add terrain validation helper
  - Create validate_terrain(terrain, width, height)
  - Check bounds, character validity, nil values
  - Use in all generators before returning

================================================================================
TESTING & QUALITY ASSURANCE
================================================================================

[P2] Expand test coverage to all 20 generators
  - Currently only 5 generators tested
  - Add test suites for remaining 15 generators
  - Target: 100% generator coverage

[P2] Add integration tests
  - Test full pipeline: generate → save → load → render
  - Verify file I/O operations
  - Test error handling paths

[P2] Add performance benchmarks
  - Measure generation time for each terrain type
  - Test with various dimensions
  - Track performance regressions
  - Document expected performance characteristics

[P2] Add property-based testing
  - Test invariants: terrain dimensions match input
  - All characters in output are valid
  - Seed determinism: same seed = same output

[P2] Create visual regression tests
  - Generate reference images with fixed seeds
  - Compare against references
  - Validate algorithm improvements

================================================================================
DOCUMENTATION
================================================================================

[P1] Create comprehensive API documentation
  - Document all helper functions
  - Use LDoc or similar
  - Parameter types, ranges, returns, examples

[P1] Document generator parameters
  - Create docs/generators.md
  - Full parameter reference for all 20 generators
  - Scientific rationale and research links
  - Example configurations

[P1] Add CONTRIBUTING.md
  - Guidelines for adding new generators
  - Code style requirements
  - Testing requirements
  - How to cite research papers

[P1] Create examples/ directory
  - Example 1: Generate terrain programmatically
  - Example 2: Batch generate multiple terrains
  - Example 3: Export terrain to different formats
  - Example 4: Integrate with game engines
  - Example 5: Combine multiple terrain types

[P1] Add CHANGELOG.md
  - Document version history
  - Track breaking changes
  - Credit contributors

[P1] Link research to implementation
  - Create docs/research.md
  - Map papers to generators and algorithms
  - Explain parameter mappings

[P1] Create architecture documentation
  - Document generator abstraction
  - Explain helper utilities
  - Diagram data flow
  - Document terrain character encoding

================================================================================
FEATURES FOR PRACTITIONERS
================================================================================

[P1] Add seed persistence and display
  - Show current seed in UI
  - Allow user to input specific seed
  - Save seed with exported terrain
  - Enable reproducible generation

[P1] Implement terrain export functionality
  - Export formats: PNG/JPG, grayscale heightmaps, JSON, CSV, SVG
  - Include metadata: seed, generator type, parameters, timestamp

[P1] Add CLI interface
  - Enable headless terrain generation
  - Usage: cosmo generate --type=desert --width=200 --height=150 --output=terrain.png
  - Support batch generation
  - Essential for asset pipelines

[P1] Expose generator parameters in UI
  - Add parameter controls overlay (toggle with key)
  - Sliders/inputs for configurable params
  - Real-time parameter preview
  - Save/load parameter presets

[P1] Add custom dimension support
  - Currently hardcoded to 120x80
  - Add UI controls to set width/height
  - Remember last used dimensions
  - Presets: Small, Medium, Large, Huge

[P1] Implement terrain composition system
  - Combine multiple terrain types
  - Blending modes: overlay, multiply, screen
  - Layer-based approach with masks

[P2] Add batch generation mode
  - Generate N variations
  - Different seeds, varied parameters
  - Export all at once
  - Use case: asset packs for games

[P2] Create programmatic API / library mode
  - Decouple from Love2d where possible
  - Allow using Cosmo as Lua library
  - Enable integration into non-Love2d projects

[P2] Add heightmap export with elevation data
  - Convert character terrain to height values
  - Export as 16-bit grayscale PNG
  - Critical for 3D applications

[P2] Implement undo/redo functionality
  - Keep history of last N terrains
  - Navigate with Ctrl+Z, Ctrl+Y
  - Useful for exploration

[P2] Add terrain preview thumbnails
  - Generate small previews of all terrain types
  - Display in grid view
  - Quick reference

================================================================================
NEW GENERATORS & ALGORITHMS
================================================================================

[P3] Add wetland/marsh generator
[P3] Add savanna/grassland generator
[P3] Add karst/limestone cave generator
[P3] Add impact crater generator
[P3] Add river delta generator
[P3] Add plateau/mesa generator

================================================================================
PERFORMANCE & OPTIMIZATION
================================================================================

[P2] Optimize noise generation
  - Cache noise values
  - Use lookup tables
  - Profile and optimize hot paths

[P2] Add progressive generation for large terrains
  - Generate in chunks for >500x500
  - Display progress indicator
  - Allow cancellation

[P2] Implement multi-threading
  - Use love.thread
  - Parallelize independent tile generation
  - Useful for batch generation

[P3] Add LOD (Level of Detail) support

================================================================================
USER EXPERIENCE IMPROVEMENTS
================================================================================

[P2] Add zoom and pan controls
[P2] Add minimap/overview
[P2] Implement terrain info overlay
[P2] Add color scheme selector
[P2] Add help overlay (F1 or ?)
[P3] Add animation/transition between terrains

================================================================================
INTEGRATION & ECOSYSTEM
================================================================================

[P3] Create Unity plugin/exporter
[P3] Create Godot plugin/exporter
[P3] Add web version (love.js)
[P3] Create REST API server
[P3] Add texture generation from terrain

================================================================================
SUMMARY OF CHANGES (2025-12-13)
================================================================================

Fixed: 11 critical bugs (P0 and P1)
Created: 3 new files (math.lua, .luacheckrc, .stylua.toml, config.yaml)
Standardized: 20 terrain generators to consistent API
Updated: 8 files with bug fixes and improvements

Remaining High Priority: 2 P0 items, 14 P1 items
Total Remaining Tasks: ~100+ items across all priorities

Philosophy maintained: All changes preserve research-driven approach while
improving practitioner accessibility and code quality.
